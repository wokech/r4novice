# Importing data and saving analysis outputs {#sec-import-save}

## Questions

-   Can users access and use internal datasets for analysis in R? How do I load the datasets?

-   How does one import external datasets into R? What functions and packages are commonly used for this purpose?

-   How do I handle different data formats such as CSV, Excel, or text files?

-   Once the user completes their data analysis, how can their output(s) be saved?

-   How can I create new data objects or modify existing ones within R?

## Learning Objectives

-   Learn how to load and access internal R datasets.

-   Import external datasets into your R project folder.

-   Demonstrate how to save analysis outputs from R such as tables and datasets.

-   Understand methods for importing data stored internally in R and from external sources.

-   Utilize built-in functions and packages to read various data formats like CSV, Excel, and text files.

## Lesson Content

### Introduction

A dataset is a collection of data, and R offers the user the opportunity to either use internal datasets or import external datasets for analysis. In this lesson, we will cover the basics of accessing internal datasets, the importation of external datasets, as well as the saving of analysis outputs, such as plots and tables.

### Working with internal datasets

R has several built-in datasets. To access them, we use the `data()` function after loading in the datasets library.

```{r}
library(datasets)

print(data())
```

To find out more about a specific dataset, we use the `?` operator.

`?dataset`

Example:

```{r}
print(?airquality)
```

**Helpful functions when working with datasets**

#### Loading datasets

`datasets::dataset`

OR

`datasets("dataset")`

Example:

```{r}
datasets::airquality
```

```{r}
data("airquality")
```

#### Print datasets

`print(dataset)`

Example:

```{r}
print(airquality)
```

#### Inspect head and tail of datasets

`head(dataset)`

OR

`tail(dataset)`

Example:

```{r}
head(airquality)
```

```{r}
tail(airquality)
```

#### Inspect the column and row names in the dataset

Names

`names(dataset)`

Row names

`rownames(dataset)`

Column names

`colnames(dataset)`

Example:

```{r}
names(airquality)
```

```{r}
rownames(airquality)
```

```{r}
colnames(airquality)
```

#### Dataset dimensions

Dimensions

`dim()`

Number of rows

`nrow()`

Number of columns

`ncol()`

Example:

```{r}
dim(airquality)
```

```{r}
nrow(airquality)
```

```{r}
ncol(airquality)
```

#### Summary statistics for the dataset

Summary of the dataset

`summary()`

Example:

```{r}
summary(airquality)
```

Access specific columns in a dataset

`dataset$column`

Example:

```{r}
airquality$Ozone
```

### Importing external datasets

As an R user, one of the tasks that you will often engage in is the importation of data from various sources. The commonly used data types include, but are not limited to CSV, TXT, JSON, SQL, SAS, STATA, SPSS, and XLSX. Additionally, R has two native data formats: Rdata (Rda) and Rds. Rdata is for multiple objects, while Rds is for a single R object.

When importing external data, first set the correct working directory. The function `getwd()` will show the current working directory and `setwd(file_path_name)` will set the working directory to the file path name specified.

**NOTE**: External datasets can be accessed from multiple sources. Examples include can be found in the Appendix 1 (@sec-appendix-1). Both of these websites contain large repositories of datasets that can be used for the examples provided below.

Download the datasets from Appendix 2 (@sec-appendix-2) and save them to your working directory.

Data importation can use base R functions or the `readr` package, which is part of the tidyverse. We will review both sets of methods in this section

#### Base R

1.  Commonly-used data importation formats

There is a wide variety of base R functions used for importing external data into R. The main format for importing data is shown below:

`read.___(path to file, header = __, sep = “_”, dec = “_”)`

-   The argument “path to file” provides the location of the file the user intends to import.

-   The argument header is set as either TRUE or FALSE, if TRUE, R assumes that the file has a header.

-   The sep argument is a group of field separation characters which include , `,`, `;`, or `\t`.

-   The dec argument allows one to set the different characters for decimal points which include `.` or `,`.

-   The stringsAsFactors argument, by default, allows strings to be read as factors. This can be set as TRUE or FALSE

The main functions for importing data using base R are listed below:

-   `read.table()` is a general function to read in a file in table format as a data frame.

Example:

```{r}
read.table("datasets/r4novice_datafile.csv", header = TRUE, sep = ",")
```

-   `read.csv()` imports data with comma separated values. Alternatively, we use `read.csv2()` is used where comma “,” indicates a decimal point and a semicolon is a field separator.

Example:

```{r}
read.csv("datasets/r4novice_datafile.csv", header = TRUE, sep = ",")
```

-   `read.delim()` is used for files with tab-separated values, such as TXT and where point “.” is used as a decimal point. Alternatively, `read.delim2()` is used for files with tab-separated values such as TXT and where comma “,” is used as a decimal point.

Example:

```{r}
read.delim("datasets/r4novice_datafile.txt", header = TRUE)
```

-   General data import

For beginners, one can use `read.___(file.choose())` for the interactive selection of files.

Example:

`read.table(file.choose())`

**NOTE**:Run this command in your R console and select the appropriate file from the working directory. 

-   Excel (xls and xlsx) files are read in with `read.xlsx()`

Load the required library

```{r}
library(xlsx)
```

Example: 

```{r}
read.xlsx("datasets/r4novice_datafile.xls", sheetIndex = 1)
```

```{r}
read.xlsx("datasets/r4novice_datafile.xls", sheetIndex = 1)
```


2.  Less frequently used data importation formats

a.  Fixed-width formats: `read.fwf("file path", header = TRUE)`

b.  SPSS/Stata/SAS Data Files: The foreign package reads SPSS SAV files, Stata DTA files, and SAS XPORT libraries.

Steps for use:

Install the library

`install.packages("foreign")`

Load the library

`library(foreign)`

SPSS: `read.spss(“file path”, to.data.frame = __, use.value.labels = __)`

-   to.data.frame: indicates whether R should treat the loaded data as a dataframe (options are TRUE/FALSE).

-   use.value.labels: indicates whether R should convert variables with value labels into R factors (options are TRUE/FALSE).

Stata: `read.dta("file", convert.dates = __, convert.factors = __)`

convert.dates: converts Stata dates to R's Date class

convert.factors: creates factors with Stata value labels

SAS: `read.xport("file path")`

Alternatively, one can utilize specific packages like `rio` or `haven` for more complex data formats like SPSS or SAS.

Install the library

`install.packages("haven")`

Load the library

`library(haven)`

SPSS: `read_sav("file path")`

SAS: `read_sas("file path")`

c.  Native data formats in R

R Data Files: `load("file_name.rda")`

RDS Files: `readRDS("file_name.rds")`

Online Files

To download and import an online file, we use `read.html()` and `read.xml()`

Example:

`read.html("file path")`

`read.xml("file path")`

e.  Miscellaneous file formats

JSON

Install the library

`install.packages("rjson")`

Load the library

`library(rjson)`

`fromJSON(file = "file name")`

SQL

Install the library

`install.packages("RSQLite")`

Load the library

`library(RSQLite)`

`sql_connect <- dbConnect(RSQLite::SQLite(), "file name")`

`dbListTables(sql_connect)`

Matlab

Install the library

`install.packages("Rmatlab")`

Load the library

`library(Rmatlab)`

`readMat("file name")`

#### Tidyverse and the `readr` package

To enhance the speed and efficiency of data imports, the user can work with the readr package that is a part of the tidyverse. This is because the functions in this package allows for faster data imports and work similarly despite the data type that is imported.

1.  Commonly-used data importation formats in the tidyverse

-   Import flat files

read_table()

read_csv()

read_csv2()

read_tsv()

read_delim()

-   Import spreadsheets

readxl

read_xls()

read_xlsx()

read_excel()

read_excel("file path", sheet = "file path")

excel_sheets("file path")

-   Import Google Sheets

googlesheets4

read_sheet()

sheet_names()

2.  Less frequently used data importation formats

read_fwf()

read_log()

readRDS()

read_lines()

**NOTE**: Missing data is a major challenge in data analysis. Strategies for dealing with this are discussed in Chapter 12 "Handling missing data" (@sec-missing).

Once the data is imported, the user can glimpse the data with `str()`, `head()`, and `summary()` functions. Additionally, one can check various aspects of the data such as `names()`, `dim`, and `class` to validate that the import was successful.

### Saving data and analysis outputs

Both the base R functions and the `readr` package can be used to save data. This data can be in the form of cleaned/rearranged tables, or it can be other analysis outputs such as plots.

-   Base R

save()

saveRDS()

write.csv()

write.table()

fwrite()

-   Flat files

write_csv()

write_csv2()

write_tsv()

write_delim()

-   Excel files

openxlsx

writexl

tidyxl

write_xlsx()

-   Google Sheets

write_sheet()

## Exercises

i.  Access the `mtcars`, `iris`, and `airquality` datasets and read the documentation using `?`. Additionally, explore the different characteristics of the data, such as names, dimensions, and summary statistics.

ii. Import datasets from different formats like [CSV](), [Excel](), and [text]() files into your R environment using the base R functions such as read.\*().

iii. Save your file using a new name with write.\*(), save(), or .RData?

iv. How can you check the structure and summary statistics of an imported dataset in R?

v.  What options do you have when importing data from non-local sources like URLs or databases? Explore functions like url() and dbConnect() for remote data access.

vi. How can you specify import options for different file formats? Learn about arguments like sep, header, and na.strings for customized data reading.

vii. What is the difference between overwriting a dataset and appending new data to it in R?

## Summary

In this lesson, the learner has been guided through the process of accessing internal datasets. Additionally, methods for importing external datasets have been demonstrated for various data formats. Lastly, the learner has been shown how to save the outputs of the data analysis. With this knowledge, the learner sis now ready to perform basic arithmetic operations, which will be covered in the next chapter.
